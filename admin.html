<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Poker de Quinta - Admin Dashboard</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Anton&family=Roboto:wght@300;400;700&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Roboto', sans-serif;
  background: #0d1b0d;
  color: #fff;
  min-height: 100vh;
  padding: 20px;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

/* HEADER */
.header {
  text-align: center;
  padding: 30px 20px;
  background: linear-gradient(135deg, #102810 0%, #1a3d1a 100%);
  border: 2px solid #d4a121;
  border-radius: 15px;
  margin-bottom: 30px;
}

.header h1 {
  font-family: 'Anton';
  font-size: 2.5em;
  color: #d4a121;
  letter-spacing: 3px;
  margin-bottom: 10px;
}

.header p {
  opacity: 0.8;
  font-size: 1.1em;
}

.back-btn {
  display: inline-block;
  margin-top: 15px;
  padding: 10px 25px;
  background: #c72c48;
  color: #fff;
  text-decoration: none;
  border-radius: 25px;
  font-weight: bold;
  transition: all 0.3s;
}

.back-btn:hover {
  background: #e63950;
  transform: translateY(-2px);
}

/* STATS GRID */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.stat-card {
  background: linear-gradient(135deg, #102810 0%, #1a3d1a 100%);
  border: 2px solid #d4a121;
  border-radius: 15px;
  padding: 30px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: linear-gradient(90deg, #d4a121, #f4c141);
}

.stat-icon {
  font-size: 3em;
  margin-bottom: 15px;
  display: block;
}

.stat-value {
  font-family: 'Anton';
  font-size: 3em;
  color: #d4a121;
  letter-spacing: 2px;
  margin-bottom: 10px;
}

.stat-label {
  font-size: 1.1em;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* VISITAS TABLE */
.visits-section {
  background: linear-gradient(135deg, #102810 0%, #1a3d1a 100%);
  border: 2px solid #d4a121;
  border-radius: 15px;
  padding: 30px;
  margin-bottom: 30px;
}

.visits-section h2 {
  font-family: 'Anton';
  font-size: 2em;
  color: #d4a121;
  margin-bottom: 20px;
  letter-spacing: 2px;
}

.filter-controls {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.filter-btn {
  padding: 10px 20px;
  background: #1a3d1a;
  border: 2px solid #d4a121;
  color: #fff;
  border-radius: 25px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
}

.filter-btn:hover,
.filter-btn.active {
  background: #d4a121;
  color: #000;
  transform: translateY(-2px);
}

.refresh-btn {
  padding: 10px 20px;
  background: #c72c48;
  border: none;
  color: #fff;
  border-radius: 25px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s;
  margin-left: auto;
}

.refresh-btn:hover {
  background: #e63950;
  transform: translateY(-2px);
}

.table-wrapper {
  overflow-x: auto;
  margin-top: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 600px;
}

thead {
  background: #1a3d1a;
}

th {
  padding: 15px;
  text-align: left;
  font-weight: bold;
  color: #d4a121;
  border-bottom: 2px solid #d4a121;
}

td {
  padding: 12px 15px;
  border-bottom: 1px solid rgba(212, 161, 33, 0.2);
}

tbody tr:hover {
  background: rgba(212, 161, 33, 0.1);
}

.no-data {
  text-align: center;
  padding: 40px;
  opacity: 0.6;
  font-style: italic;
}

/* CHARTS */
.charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.chart-card {
  background: linear-gradient(135deg, #102810 0%, #1a3d1a 100%);
  border: 2px solid #d4a121;
  border-radius: 15px;
  padding: 30px;
}

.chart-card h3 {
  font-family: 'Anton';
  font-size: 1.5em;
  color: #d4a121;
  margin-bottom: 20px;
  letter-spacing: 1px;
}

.chart-bar {
  margin-bottom: 15px;
}

.chart-label {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
  font-size: 0.9em;
}

.bar {
  height: 30px;
  background: linear-gradient(90deg, #d4a121, #f4c141);
  border-radius: 5px;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  animation: shimmer 2s infinite;
}

@keyframes shimmer {
  to { left: 100%; }
}

.loading {
  text-align: center;
  padding: 40px;
  font-size: 1.2em;
  opacity: 0.7;
}

.loading::after {
  content: '...';
  animation: dots 1.5s infinite;
}

@keyframes dots {
  0%, 20% { content: '.'; }
  40% { content: '..'; }
  60%, 100% { content: '...'; }
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .header h1 {
    font-size: 1.8em;
  }
  
  .stat-value {
    font-size: 2em;
  }
  
  .charts-grid {
    grid-template-columns: 1fr;
  }
  
  .filter-controls {
    flex-direction: column;
  }
  
  .refresh-btn {
    margin-left: 0;
  }
}
</style>
</head>

<body>

<div class="container">
  
  <!-- HEADER -->
  <div class="header">
    <h1>üîê ADMIN DASHBOARD</h1>
    <p>Painel de Controle - Poker de Quinta</p>
    <a href="index.html" class="back-btn">‚Üê Voltar ao Site</a>
  </div>
  
  <!-- STATS GRID -->
  <div class="stats-grid">
    <div class="stat-card">
      <span class="stat-icon">üëÅÔ∏è</span>
      <div class="stat-value" id="totalVisits">...</div>
      <div class="stat-label">Total de Visitas</div>
    </div>
    
    <div class="stat-card">
      <span class="stat-icon">üìÖ</span>
      <div class="stat-value" id="todayVisits">...</div>
      <div class="stat-label">Visitas Hoje</div>
    </div>
    
    <div class="stat-card">
      <span class="stat-icon">üìä</span>
      <div class="stat-value" id="weekVisits">...</div>
      <div class="stat-label">Visitas esta Semana</div>
    </div>
    
    <div class="stat-card">
      <span class="stat-icon">üìà</span>
      <div class="stat-value" id="monthVisits">...</div>
      <div class="stat-label">Visitas este M√™s</div>
    </div>
  </div>
  
  <!-- CHARTS -->
  <div class="charts-grid">
    <div class="chart-card">
      <h3>üìä Visitas por Dia (√öltimos 7 dias)</h3>
      <div id="dailyChart"></div>
    </div>
    
    <div class="chart-card">
      <h3>üïê Visitas por Hora (Hoje)</h3>
      <div id="hourlyChart"></div>
    </div>
  </div>
  
  <!-- VISITS TABLE -->
  <div class="visits-section">
    <h2>üìã Registro de Visitas</h2>
    
    <div class="filter-controls">
      <button class="filter-btn active" onclick="filterVisits('all')">Todas</button>
      <button class="filter-btn" onclick="filterVisits('today')">Hoje</button>
      <button class="filter-btn" onclick="filterVisits('week')">Esta Semana</button>
      <button class="filter-btn" onclick="filterVisits('month')">Este M√™s</button>
      <button class="refresh-btn" onclick="loadData()">üîÑ Atualizar</button>
    </div>
    
    <div class="table-wrapper">
      <table id="visitsTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Data/Hora</th>
            <th>P√°gina</th>
            <th>Navegador</th>
          </tr>
        </thead>
        <tbody id="visitsTableBody">
          <tr><td colspan="4" class="loading">Carregando dados</td></tr>
        </tbody>
      </table>
    </div>
  </div>
  
</div>

<script>
let allVisits = [];
let currentFilter = 'all';

// Carregar todos os dados
async function loadData() {
  try {
    // Buscar total de visitas da CountAPI
    const response = await fetch('https://api.countapi.xyz/get/pokerdequinta/visits');
    const data = await response.json();
    
    const totalVisits = data.value || 0;
    document.getElementById('totalVisits').textContent = totalVisits.toLocaleString('pt-BR');
    
    // Buscar visitas do localStorage
    allVisits = JSON.parse(localStorage.getItem('poker_visits') || '[]');
    
    // Ordenar por data (mais recente primeiro)
    allVisits.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    
    // Calcular estat√≠sticas
    calculateStats();
    
    // Renderizar gr√°ficos
    renderCharts();
    
    // Renderizar tabela
    renderVisitsTable();
    
  } catch (error) {
    console.error('Erro ao carregar dados:', error);
    document.getElementById('visitsTableBody').innerHTML = 
      '<tr><td colspan="4" class="no-data">Erro ao carregar dados</td></tr>';
  }
}

// Calcular estat√≠sticas
function calculateStats() {
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const weekAgo = new Date(today);
  weekAgo.setDate(weekAgo.getDate() - 7);
  const monthAgo = new Date(today);
  monthAgo.setMonth(monthAgo.getMonth() - 1);
  
  const todayCount = allVisits.filter(v => new Date(v.timestamp) >= today).length;
  const weekCount = allVisits.filter(v => new Date(v.timestamp) >= weekAgo).length;
  const monthCount = allVisits.filter(v => new Date(v.timestamp) >= monthAgo).length;
  
  document.getElementById('todayVisits').textContent = todayCount.toLocaleString('pt-BR');
  document.getElementById('weekVisits').textContent = weekCount.toLocaleString('pt-BR');
  document.getElementById('monthVisits').textContent = monthCount.toLocaleString('pt-BR');
}

// Renderizar gr√°ficos
function renderCharts() {
  renderDailyChart();
  renderHourlyChart();
}

// Gr√°fico di√°rio (√∫ltimos 7 dias)
function renderDailyChart() {
  const days = [];
  const counts = [];
  
  for (let i = 6; i >= 0; i--) {
    const date = new Date();
    date.setDate(date.getDate() - i);
    date.setHours(0, 0, 0, 0);
    
    const nextDate = new Date(date);
    nextDate.setDate(nextDate.getDate() + 1);
    
    const count = allVisits.filter(v => {
      const vDate = new Date(v.timestamp);
      return vDate >= date && vDate < nextDate;
    }).length;
    
    days.push(date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' }));
    counts.push(count);
  }
  
  const maxCount = Math.max(...counts, 1);
  
  let html = '';
  for (let i = 0; i < days.length; i++) {
    const percentage = (counts[i] / maxCount) * 100;
    html += `
      <div class="chart-bar">
        <div class="chart-label">
          <span>${days[i]}</span>
          <span><strong>${counts[i]}</strong> visitas</span>
        </div>
        <div class="bar" style="width: ${percentage}%"></div>
      </div>
    `;
  }
  
  document.getElementById('dailyChart').innerHTML = html || '<div class="no-data">Sem dados</div>';
}

// Gr√°fico por hora (hoje)
function renderHourlyChart() {
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  const hours = Array(24).fill(0);
  
  allVisits.forEach(v => {
    const vDate = new Date(v.timestamp);
    if (vDate >= today) {
      const hour = vDate.getHours();
      hours[hour]++;
    }
  });
  
  const maxCount = Math.max(...hours, 1);
  
  let html = '';
  const currentHour = new Date().getHours();
  
  for (let i = 0; i <= currentHour; i++) {
    const percentage = (hours[i] / maxCount) * 100;
    html += `
      <div class="chart-bar">
        <div class="chart-label">
          <span>${i}h - ${i+1}h</span>
          <span><strong>${hours[i]}</strong> visitas</span>
        </div>
        <div class="bar" style="width: ${percentage}%"></div>
      </div>
    `;
  }
  
  document.getElementById('hourlyChart').innerHTML = html || '<div class="no-data">Sem dados hoje</div>';
}

// Renderizar tabela de visitas
function renderVisitsTable() {
  let filteredVisits = allVisits;
  
  if (currentFilter === 'today') {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    filteredVisits = allVisits.filter(v => new Date(v.timestamp) >= today);
  } else if (currentFilter === 'week') {
    const weekAgo = new Date();
    weekAgo.setDate(weekAgo.getDate() - 7);
    filteredVisits = allVisits.filter(v => new Date(v.timestamp) >= weekAgo);
  } else if (currentFilter === 'month') {
    const monthAgo = new Date();
    monthAgo.setMonth(monthAgo.getMonth() - 1);
    filteredVisits = allVisits.filter(v => new Date(v.timestamp) >= monthAgo);
  }
  
  if (filteredVisits.length === 0) {
    document.getElementById('visitsTableBody').innerHTML = 
      '<tr><td colspan="4" class="no-data">Nenhuma visita registrada</td></tr>';
    return;
  }
  
  // Limitar a 100 registros mais recentes
  const displayVisits = filteredVisits.slice(0, 100);
  
  let html = '';
  displayVisits.forEach((visit, index) => {
    const date = new Date(visit.timestamp);
    const formattedDate = date.toLocaleString('pt-BR', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    });
    
    html += `
      <tr>
        <td>${index + 1}</td>
        <td>${formattedDate}</td>
        <td>${visit.page || 'home'}</td>
        <td>üåê Navegador</td>
      </tr>
    `;
  });
  
  document.getElementById('visitsTableBody').innerHTML = html;
}

// Filtrar visitas
function filterVisits(filter) {
  currentFilter = filter;
  
  // Atualizar bot√µes
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.remove('active');
  });
  event.target.classList.add('active');
  
  renderVisitsTable();
}

// Carregar dados ao iniciar
loadData();

// Atualizar automaticamente a cada 30 segundos
setInterval(loadData, 30000);
</script>

</body>
</html>
